// ==== index.html (클라이언트) ====
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>실시간 PVP 예제</title>
  <style>
    body { background: black; color: lime; font-family: monospace; text-align: center; }
    canvas { border: 1px solid lime; background: #111; }
    button { margin: 10px; padding: 10px; }
  </style>
</head>
<body>
  <h1>TV Girl 전장</h1>
  <button onclick="spawn('tv_girl')">TV Girl 소환</button>
  <canvas id="game" width="800" height="400"></canvas>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    const socket = io('https://moondo-production.up.railway.app');
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const units = [];

    const spriteMap = {
      'tv_girl': new Image()
    };
    spriteMap['tv_girl'].src = 'tv_girl/stand.png';

    socket.on('unit_spawned', unit => units.push(unit));
    socket.on('full_state', state => {
      units.length = 0;
      units.push(...state.units);
    });

    function spawn(type) {
      socket.emit('spawn_unit', { owner: socket.id, x: 50, y: Math.random() * 300 + 50, type });
    }

    function update() {
      units.forEach(u => u.x += (u.owner === socket.id ? 1 : -1));
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      units.forEach(u => {
        ctx.drawImage(spriteMap[u.type], u.x, u.y, 48, 48);
      });
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    socket.emit('request_sync');
    gameLoop();
  </script>
</body>
</html>
